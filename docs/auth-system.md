# ë¸Œë¦¿ì§€ë©”ì´ì»¤ìŠ¤ ì›¹ì‚¬ì´íŠ¸ ì¸ì¦ ì‹œìŠ¤í…œ ë¬¸ì„œ

## ëª©ì°¨
- [ì‹œìŠ¤í…œ êµ¬ì¡°](#ì‹œìŠ¤í…œ-êµ¬ì¡°)
- [ì£¼ìš” ì»´í¬ë„ŒíŠ¸](#ì£¼ìš”-ì»´í¬ë„ŒíŠ¸)
- [ì¸ì¦ í”„ë¡œì„¸ìŠ¤](#ì¸ì¦-í”„ë¡œì„¸ìŠ¤)
- [ì„±ëŠ¥ ìµœì í™”](#ì„±ëŠ¥-ìµœì í™”)
- [ë¬¸ì œ í•´ê²°](#ë¬¸ì œ-í•´ê²°)

## ì‹œìŠ¤í…œ êµ¬ì¡°

### Supabase í´ë¼ì´ì–¸íŠ¸ ê´€ë¦¬
í´ë¼ì´ì–¸íŠ¸ëŠ” Next.js App Routerì™€ Supabase Auth Helpersë¥¼ ì‚¬ìš©í•˜ì—¬ êµ¬í˜„ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

```typescript
// lib/supabase/client.ts
import { createClientComponentClient } from '@supabase/auth-helpers-nextjs';

export const supabase = createClientComponentClient<Database>();
```

### ìƒíƒœ ê´€ë¦¬
- `session`: í˜„ì¬ ì¸ì¦ ì„¸ì…˜
- `user`: ê¸°ë³¸ ì‚¬ìš©ì ì •ë³´
- `userProfile`: í™•ì¥ëœ ì‚¬ìš©ì í”„ë¡œí•„ ì •ë³´
- `isLoading`: ì¸ì¦/í”„ë¡œí•„ ë¡œë”© ìƒíƒœ

## ì¸ì¦ í”„ë¡œì„¸ìŠ¤

### 1. ì´ˆê¸°í™” ê³¼ì •

```mermaid
graph TD
    A[ì•± ì‹œì‘] --> B[RootLayoutì—ì„œ ì„œë²„ ì„¸ì…˜ í™•ì¸]
    B --> C[AuthProvider ì´ˆê¸°í™”]
    C --> D[ì‹¤ì‹œê°„ ì¸ì¦ ìƒíƒœ êµ¬ë…]
    D --> E[ì‚¬ìš©ì í”„ë¡œí•„ ë¡œë“œ]
```

1. **ì•± ì‹œì‘ ì‹œ:**
   - `RootLayout`ì—ì„œ ì„œë²„ ì„¸ì…˜ í™•ì¸
   - `AuthProvider`ì— ì´ˆê¸° ì„¸ì…˜ ì „ë‹¬
   - ì‹¤ì‹œê°„ ì¸ì¦ ìƒíƒœ êµ¬ë… ì„¤ì •

2. **ì„¸ì…˜ ì¡´ì¬ ì‹œ:**
   - ì‚¬ìš©ì í”„ë¡œí•„ DB ì¡°íšŒ
   - í”„ë¡œí•„ ì •ë³´ ìƒíƒœ ì €ì¥
   - ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ êµ¬ë…

### 2. ì¸ì¦ ë°©ì‹

#### OAuth ë¡œê·¸ì¸ (Google)
```typescript
const signIn = async (provider: 'google') => {
  await supabase.auth.signInWithOAuth({
    provider,
    options: {
      redirectTo: `${window.location.origin}/auth/callback`,
    },
  });
};
```

#### ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ ë¡œê·¸ì¸
```typescript
const signInWithEmail = async (email: string, password: string) => {
  await supabase.auth.signInWithPassword({
    email,
    password,
  });
};
```

#### íšŒì›ê°€ì…
```typescript
const signUpWithEmail = async (email: string, password: string, firstName: string, lastName: string) => {
  await supabase.auth.signUp({
    email,
    password,
    options: {
      data: {
        first_name: firstName,
        last_name: lastName,
      },
      emailRedirectTo: `${window.location.origin}/auth/callback`,
    },
  });
};
```

### 3. í”„ë¡œí•„ ê´€ë¦¬

#### í”„ë¡œí•„ ì¡°íšŒ ë¡œì§
```typescript
const loadUserProfile = async () => {
  if (!user) {
    setUserProfile(null);
    return;
  }

  const { data, error } = await supabase
    .from('users')
    .select('*')
    .eq('id', user.id)
    .single();

  if (error) {
    await createUserProfile(user);
  } else {
    setUserProfile(data);
  }
};
```

#### í”„ë¡œí•„ ìƒì„± ë¡œì§
```typescript
const createUserProfile = async (user: User) => {
  const { data } = await supabase
    .from('users')
    .insert([
      {
        id: user.id,
        email: user.email,
        first_name: user.user_metadata?.first_name,
        last_name: user.user_metadata?.last_name,
        profile_image_url: user.user_metadata?.avatar_url,
        user_level: UserRole.BASIC,
      },
    ])
    .select()
    .single();

  setUserProfile(data);
};
```

## ì„±ëŠ¥ ìµœì í™”

### 1. ì„œë²„ ì‚¬ì´ë“œ ë Œë”ë§
- `RootLayout`ì—ì„œ ì´ˆê¸° ì„¸ì…˜ í™•ì¸
- ì„œë²„ ì»´í¬ë„ŒíŠ¸ì—ì„œ ë°ì´í„° í”„ë¦¬í˜ì¹˜
- í´ë¼ì´ì–¸íŠ¸ í•˜ì´ë“œë ˆì´ì…˜ ìµœì í™”

### 2. ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
- Supabase ì‹¤ì‹œê°„ êµ¬ë…ìœ¼ë¡œ ì¦‰ì‹œ ìƒíƒœ ë°˜ì˜
- Context APIë¥¼ í†µí•œ íš¨ìœ¨ì ì¸ ìƒíƒœ ê³µìœ 
- ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”ë§ ë°©ì§€

### 3. ì—ëŸ¬ ì²˜ë¦¬
- ì„¸ë¶€ì ì¸ ì—ëŸ¬ ë©”ì‹œì§€ ì²˜ë¦¬
- ì‚¬ìš©ì ì¹œí™”ì ì¸ ì—ëŸ¬ í‘œì‹œ
- ìë™ ë³µêµ¬ ë©”ì»¤ë‹ˆì¦˜

## ë¬¸ì œ í•´ê²°

### ì¼ë°˜ì ì¸ ë¬¸ì œë“¤

1. **ì¸ì¦ ìƒíƒœ ë¶ˆì¼ì¹˜**
   - ë¸Œë¼ìš°ì € ë°ì´í„° ì´ˆê¸°í™” ê¸°ëŠ¥ ì œê³µ
   - ìë™ ì„¸ì…˜ ê°±ì‹ 
   - í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ìœ¼ë¡œ ìƒíƒœ ë™ê¸°í™”

2. **ë¦¬ë‹¤ì´ë ‰ì…˜ ë¬¸ì œ**
   - `/auth/callback` í˜ì´ì§€ì—ì„œ ì ì ˆí•œ ì²˜ë¦¬
   - ì—ëŸ¬ ë°œìƒ ì‹œ ì „ìš© ì—ëŸ¬ í˜ì´ì§€ë¡œ ì´ë™
   - ì¸ì¦ ì™„ë£Œ ì‹œ ì›ë˜ í˜ì´ì§€ë¡œ ë³µê·€

3. **í”„ë¡œí•„ ë™ê¸°í™”**
   - ì‹¤ì‹œê°„ êµ¬ë…ìœ¼ë¡œ ì¦‰ì‹œ ë°˜ì˜
   - í”„ë¡œí•„ ì—†ì„ ì‹œ ìë™ ìƒì„±
   - ìƒíƒœ ë³€ê²½ ì‹œ UI ì¦‰ì‹œ ì—…ë°ì´íŠ¸

### ë””ë²„ê¹… íŒ

ì½˜ì†” ë¡œê·¸ íŒ¨í„´:
- ğŸš€ ì´ˆê¸°í™” ê´€ë ¨
- ğŸ”„ ìƒíƒœ ë³€í™”
- âœ… ì„±ê³µ
- âŒ ì—ëŸ¬
- âš ï¸ ê²½ê³ 
- ğŸ“¡ ë„¤íŠ¸ì›Œí¬ ìš”ì²­
- ğŸ” ë°ì´í„° í™•ì¸

### ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

1. **í† í° ê´€ë¦¬**
   - httpOnly ì¿ í‚¤ ì‚¬ìš©
   - ìë™ í† í° ê°±ì‹ 
   - ì•ˆì „í•œ ì €ì¥ì†Œ í™œìš©

2. **ê¶Œí•œ ê²€ì‚¬**
   - ì„œë²„ ì‚¬ì´ë“œ ê²€ì¦ í•„ìˆ˜
   - ì—­í•  ê¸°ë°˜ ì ‘ê·¼ ì œì–´
   - ë¯¸ë“¤ì›¨ì–´ì—ì„œ ë¼ìš°íŠ¸ ë³´í˜¸

# ì¸ì¦ ì‹œìŠ¤í…œ ì„¤ê³„

## ê¸°ë³¸ ì›ì¹™

1. **ì„œë²„/í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ ë¶„ë¦¬**
   - ì„œë²„ ì»´í¬ë„ŒíŠ¸: ì´ˆê¸° ë°ì´í„° ë¡œë”©, SEO ê´€ë ¨ ì‘ì—…
   - í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸: ìƒí˜¸ì‘ìš©, ì‹¤ì‹œê°„ ìƒíƒœ ê´€ë¦¬

2. **ë°ì´í„° í˜ì¹­ ì „ëµ**
   - ì´ˆê¸° ë°ì´í„°: ì„œë²„ ì‚¬ì´ë“œì—ì„œ ì²˜ë¦¬
   - ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸: í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œì—ì„œ ì²˜ë¦¬
   - ì‚¬ìš©ì ì•¡ì…˜: Server Actions ì‚¬ìš©

## ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°

```
app/
  â”œâ”€â”€ components/
  â”‚   â””â”€â”€ auth/
  â”‚       â”œâ”€â”€ AuthProvider.tsx (ì„œë²„ ì»´í¬ë„ŒíŠ¸)
  â”‚       â”œâ”€â”€ ClientAuthProvider.tsx (í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸)
  â”‚       â””â”€â”€ AuthButtons.tsx (í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸)
  â””â”€â”€ lib/
      â””â”€â”€ auth/
          â”œâ”€â”€ actions.ts (ì„œë²„ ì•¡ì…˜)
          â””â”€â”€ client.ts (í´ë¼ì´ì–¸íŠ¸ ìœ í‹¸ë¦¬í‹°)
```

## ì»´í¬ë„ŒíŠ¸ë³„ ì±…ì„

### AuthProvider (ì„œë²„ ì»´í¬ë„ŒíŠ¸)
```typescript
async function AuthProvider({ children }) {
  // 1. ì„œë²„ì—ì„œ ì´ˆê¸° ì„¸ì…˜ í™•ì¸
  // 2. ì´ˆê¸° ì‚¬ìš©ì ë°ì´í„° í”„ë¦¬í˜ì¹˜
  // 3. ClientAuthProviderì— ì´ˆê¸° ë°ì´í„° ì „ë‹¬
}
```

### ClientAuthProvider (í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸)
```typescript
export function ClientAuthProvider({ 
  initialSession, 
  initialProfile, 
  children 
}) {
  // 1. ì´ˆê¸° ë°ì´í„°ë¡œ ìƒíƒœ ì´ˆê¸°í™”
  // 2. ì‹¤ì‹œê°„ ì„¸ì…˜ ì—…ë°ì´íŠ¸ ì²˜ë¦¬
  // 3. Contextë¥¼ í†µí•œ ìƒíƒœ ê³µìœ 
}
```

## ë°ì´í„° íë¦„

1. **ì´ˆê¸° ë¡œë“œ**
   - ì„œë²„ì—ì„œ ì„¸ì…˜ í™•ì¸
   - í•„ìš”í•œ ì‚¬ìš©ì ë°ì´í„° í”„ë¦¬í˜ì¹˜
   - í´ë¼ì´ì–¸íŠ¸ì— ì´ˆê¸° ìƒíƒœ ì „ë‹¬

2. **ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸**
   - Supabase ì‹¤ì‹œê°„ êµ¬ë… ì„¤ì •
   - ì„¸ì…˜/í”„ë¡œí•„ ë³€ê²½ ì‹œ ìƒíƒœ ì—…ë°ì´íŠ¸
   - Contextë¥¼ í†µí•´ í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ì— ì „íŒŒ

3. **ì‚¬ìš©ì ì•¡ì…˜**
   - Server Actionsë¥¼ í†µí•œ ë°ì´í„° ìˆ˜ì •
   - ë‚™ê´€ì  ì—…ë°ì´íŠ¸ ì ìš©
   - ì‹¤ì‹œê°„ ë™ê¸°í™”ë¡œ ìµœì¢… ìƒíƒœ ë°˜ì˜

## ì„±ëŠ¥ ìµœì í™”

1. **ì„œë²„ ì‚¬ì´ë“œ ë Œë”ë§**
   - ì´ˆê¸° HTMLì— ë°ì´í„° í¬í•¨
   - í´ë¼ì´ì–¸íŠ¸ ë²ˆë“¤ í¬ê¸° ìµœì†Œí™”
   - SEO ìµœì í™”

2. **ìºì‹± ì „ëµ**
   - ì„œë²„ ì»´í¬ë„ŒíŠ¸ ìºì‹±
   - ì •ì  ë°ì´í„° ì¬ì‚¬ìš©
   - ë™ì  ë°ì´í„° ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸

## ì—ëŸ¬ ì²˜ë¦¬

1. **ì„œë²„ ì‚¬ì´ë“œ**
   - ì„¸ì…˜ ë§Œë£Œ/ì¸ì¦ ì‹¤íŒ¨ ì²˜ë¦¬
   - ë°ì´í„°ë² ì´ìŠ¤ ì˜¤ë¥˜ ì²˜ë¦¬
   - ì ì ˆí•œ ì—ëŸ¬ í˜ì´ì§€ í‘œì‹œ

2. **í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ**
   - ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì²˜ë¦¬
   - ì‹¤ì‹œê°„ ì—°ê²° ì¬ì‹œë„
   - ì‚¬ìš©ì í”¼ë“œë°± ì œê³µ

## ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

1. **ì¸ì¦ í† í°**
   - ì•ˆì „í•œ ì €ì¥ ë° ê°±ì‹ 
   - CSRF ë³´í˜¸
   - XSS ë°©ì§€

2. **ê¶Œí•œ ê²€ì‚¬**
   - ì„œë²„ ì‚¬ì´ë“œ ê²€ì¦
   - í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ UI ì¡°ì •
   - ì—­í•  ê¸°ë°˜ ì ‘ê·¼ ì œì–´

## í…ŒìŠ¤íŠ¸ ì „ëµ

1. **ë‹¨ìœ„ í…ŒìŠ¤íŠ¸**
   - ì»´í¬ë„ŒíŠ¸ë³„ ë…ë¦½ í…ŒìŠ¤íŠ¸
   - ì¸ì¦ ë¡œì§ ê²€ì¦
   - ì—ëŸ¬ ì²˜ë¦¬ í™•ì¸

2. **í†µí•© í…ŒìŠ¤íŠ¸**
   - ì „ì²´ ì¸ì¦ í”Œë¡œìš° ê²€ì¦
   - ì‹¤ì œ API í˜¸ì¶œ í…ŒìŠ¤íŠ¸
   - ì„±ëŠ¥ ë©”íŠ¸ë¦­ ì¸¡ì • 

# ì¸ì¦ ì‹œìŠ¤í…œ ë¬¸ì œ í•´ê²° ê°€ì´ë“œ

## êµ¬ì¡°

í˜„ì¬ ì¸ì¦ ì‹œìŠ¤í…œì€ Supabase Auth Helpers for Next.jsë¥¼ ì‚¬ìš©í•˜ì—¬ êµ¬í˜„ë˜ì–´ ìˆìŠµë‹ˆë‹¤:

1. **ì„œë²„ ì»´í¬ë„ŒíŠ¸**: `createServerClient`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì„œë²„ ì¸¡ ì¸ì¦ í™•ì¸
2. **í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸**: `createClientComponentClient`ë¥¼ ì‚¬ìš©í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ ì¸¡ ì¸ì¦ ì²˜ë¦¬
3. **ë¯¸ë“¤ì›¨ì–´**: `createMiddlewareClient`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì„¸ì…˜ ê´€ë¦¬ ë° ë¼ìš°íŒ… ë³´í˜¸

## ì•Œë ¤ì§„ ë¬¸ì œ

### 1. ì¿ í‚¤ íŒŒì‹± ì˜¤ë¥˜

```
Failed to parse cookie string: SyntaxError: Unexpected token 'b', "base64-eyJ"... is not valid JSON
```

ì´ ì˜¤ë¥˜ëŠ” ë¸Œë¼ìš°ì €ì— ì €ì¥ëœ Supabase ì¸ì¦ ì¿ í‚¤ê°€ ì†ìƒë˜ì—ˆì„ ë•Œ ë°œìƒí•©ë‹ˆë‹¤.

**í•´ê²° ë°©ë²•**:
- ë¸Œë¼ìš°ì € ì¿ í‚¤ë¥¼ ì´ˆê¸°í™”í•©ë‹ˆë‹¤ (ì•±ì—ì„œ 'ë°ì´í„° ì´ˆê¸°í™”' ë²„íŠ¼ ì‚¬ìš©)
- ì‹œí¬ë¦¿ ëª¨ë“œë¡œ ì ‘ì†í•´ë´…ë‹ˆë‹¤
- ë‹¤ë¥¸ ë¸Œë¼ìš°ì €ë¡œ ì ‘ì†í•´ë´…ë‹ˆë‹¤

### 2. API ê²½ë¡œì—ì„œ Supabase í´ë¼ì´ì–¸íŠ¸ ìƒì„± ì˜¤ë¥˜

```
Attempted import error: 'createClient' is not exported from '@/lib/supabase/server'
```

**í•´ê²° ë°©ë²•**:
- `createClient` ëŒ€ì‹  `createServerClient`ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤
- API ë¼ìš°íŠ¸ì—ì„œëŠ” `cookies()` API ì‚¬ìš© ë°©ë²•ì— ì£¼ì˜í•©ë‹ˆë‹¤

## ê°œë°œ í™˜ê²½ì—ì„œ í…ŒìŠ¤íŠ¸í•˜ê¸°

1. ì¿ í‚¤ ë¬¸ì œê°€ ë°œìƒí•˜ë©´:
   ```bash
   # Next.js ìºì‹œ ì‚­ì œ
   rm -rf .next
   
   # ê°œë°œ ì„œë²„ ì¬ì‹œì‘
   npm run dev
   ```

2. ë¸Œë¼ìš°ì €ì—ì„œ:
   - ê°œë°œì ë„êµ¬ë¥¼ ì—´ê³  Application íƒ­ìœ¼ë¡œ ì´ë™
   - Cookies > localhostë¥¼ ì„ íƒ
   - `supabase` ê´€ë ¨ ì¿ í‚¤ë¥¼ ëª¨ë‘ ì‚­ì œ
   - í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨

## ì„œë²„/í´ë¼ì´ì–¸íŠ¸ ê²½ê³„ ì¤€ìˆ˜

ì¸ì¦ ê´€ë ¨ ì½”ë“œ ì‘ì„± ì‹œ ë‹¤ìŒ ê·œì¹™ì„ ë”°ë¦…ë‹ˆë‹¤:

1. **ì„œë²„ ì»´í¬ë„ŒíŠ¸ì—ì„œ**:
   - `createServerClient()`ë¥¼ ì‚¬ìš©í•˜ì—¬ Supabase í´ë¼ì´ì–¸íŠ¸ ìƒì„±
   - ì´ˆê¸° ì„¸ì…˜ ë°ì´í„° ë¡œë“œ
   - ì´ í´ë¼ì´ì–¸íŠ¸ëŠ” ì¿ í‚¤ë¥¼ ì½ì„ ìˆ˜ë§Œ ìˆìŒ

2. **í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ì—ì„œ**:
   - ë°˜ë“œì‹œ `'use client'` ì§€ì‹œë¬¸ ì‚¬ìš©
   - `createClientComponentClient()`ë¥¼ ì‚¬ìš©í•˜ì—¬ Supabase í´ë¼ì´ì–¸íŠ¸ ìƒì„±
   - ì´ í´ë¼ì´ì–¸íŠ¸ëŠ” ì¿ í‚¤ë¥¼ ì½ê³  ì“¸ ìˆ˜ ìˆìŒ
   - ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ë“± ì¸ì¦ ìƒíƒœ ë³€ê²½ ì‘ì—… ìˆ˜í–‰

3. **ë¯¸ë“¤ì›¨ì–´ì—ì„œ**:
   - `createMiddlewareClient()`ë¥¼ ì‚¬ìš©í•˜ì—¬ Supabase í´ë¼ì´ì–¸íŠ¸ ìƒì„±
   - ì„¸ì…˜ ìƒˆë¡œê³ ì¹¨ ë° ë¼ìš°íŒ… ë³´í˜¸

## ê¸°íƒ€ ë¬¸ì œ í•´ê²°

ë¬¸ì œê°€ ì§€ì†ë˜ë©´ ë‹¤ìŒì„ ì‹œë„í•´ ë³´ì„¸ìš”:

1. íŒ¨í‚¤ì§€ ì—…ë°ì´íŠ¸:
   ```bash
   npm update @supabase/auth-helpers-nextjs @supabase/supabase-js
   ```

2. ì¿ í‚¤ ê´€ë ¨ ë¯¸ë“¤ì›¨ì–´ ìˆ˜ì •:
   - `middleware.ts` íŒŒì¼ì—ì„œ ì¿ í‚¤ ì²˜ë¦¬ ë°©ì‹ ë³€ê²½
   - ë” ê°•ë ¥í•œ ì˜¤ë¥˜ ì²˜ë¦¬ ì¶”ê°€

3. ê°œë°œ í™˜ê²½ ì´ˆê¸°í™”:
   ```bash
   rm -rf node_modules .next
   npm install
   npm run dev
   ``` 